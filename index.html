<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Physics Practice Hub</title>
  <!-- Load Chart.js from a CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>	
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #eef2f3;
      margin-right: 250px; /* Reserve space for difficulty panel */
    }
    h1, h2, h3 { color: #333; }
    .section { margin-top: 30px; border-top: 1px solid #ccc; padding-top: 20px; }
    .topics-grid { display: flex; flex-wrap: wrap; gap: 20px; }
    .topic-column { flex: 1 1 300px; }
    label { display: block; margin: 5px 0; }
    button { margin-top: 20px; padding: 10px 15px; font-size: 1em; }
    #question-box {
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      margin-top: 30px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    #score-box { font-weight: bold; margin-top: 10px; }
    .question-img { max-width: 100%; height: auto; margin: 10px 0; }
    /* Difficulty panel */
    #difficulty-container {
      position: fixed;
      top: 100px;
      right: 20px;
      width: 200px;
      background: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    #difficulty-container h3 { margin-top: 0; }
  </style>
</head>
<body>
  <h1>Cambridge Physics 9702 Practice Hub</h1>

  <!-- Whole Course Section -->
  <div class="section">
    <h2>Whole Course</h2>
    <label>
      <input type="checkbox" id="whole-defs" onchange="toggleByGroup('defs', this.checked)">
      Definitions
    </label>
    <label>
      <input type="checkbox" id="whole-eqs" onchange="toggleByGroup('eqs', this.checked)">
      Equations
    </label>
    <button onclick="startPractice()">Start Practice</button>
  </div>

  <!-- By Topic Section -->
  <div class="section">
    <h2>By Topic</h2>
    <div class="topics-grid">
      <div class="topic-column" id="topic-columns-left"></div>
      <div class="topic-column" id="topic-columns-right"></div>
    </div>
  </div>

  <!-- Another Start Practice Button -->
  <div class="section">
    <button onclick="startPractice()">Start Practice</button>
  </div>

  <div id="score-box">Score: <span id="score">0</span></div>
  <div id="question-box"></div>
  
  <!-- Container for dynamic diagrams -->
  <div id="diagramContainer"></div>
  
  <!-- Container for answer inputs -->
  <div id="answerInputs"></div>
  
  <!-- Feedback area -->
  <div id="feedback" style="font-weight: bold; margin-top: 10px;"></div>
  
  <!-- Difficulty Panel -->
  <div id="difficulty-container">
    <h3>Select Difficulty</h3>
    <input type="radio" name="difficulty" id="difficulty-go-easy" value="easy" checked>
    <label for="difficulty-go-easy">Go Easy</label><br>
    <input type="radio" name="difficulty" id="difficulty-im-getting-there" value="mixed">
    <label for="difficulty-im-getting-there">I'm Getting There</label><br>
    <input type="radio" name="difficulty" id="difficulty-hard" value="hard">
    <label for="difficulty-hard">Hard</label><br>
  </div>
  
  <script>
    /* -----------------------------
       Global Variables and Setup
    ----------------------------- */
    let answeredCurrent = false;
    let currentQuestion = null;
    let currentAnswers = null;
    let score = 0;
    let mixedCount = 0;
    let questionPool = [];

    // Utility: Ordinal suffix for harmonic questions
    function ordinalSuffix(n) {
      let j = n % 10, k = n % 100;
      if (j === 1 && k !== 11) return n + "st";
      if (j === 2 && k !== 12) return n + "nd";
      if (j === 3 && k !== 13) return n + "rd";
      return n + "th";
    }

    // Utility: Return a random element from an array
    function getRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    /* ----------------------------------------------------
         DRAW SPRING CHART FUNCTION (using Chart.js)
    ---------------------------------------------------- */
    function drawSpringChart(canvasId, k, L0) {
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext('2d');
      const MAX_L = 60; // maximum extension value (in cm)
      const dataPoints = [];
      for (let L = 0; L <= MAX_L; L += 1) {
        // Calculate force from Hooke's Law: F = k * (L - L0)
        const F = Math.max(0, k * (L - L0));
        dataPoints.push({ x: L, y: F });
      }
      
      new Chart(ctx, {
        type: 'line',
        data: {
          datasets: [{
            label: 'Force vs. Extension',
            data: dataPoints,
            borderColor: 'blue',
            borderWidth: 2,
            fill: false,
            tension: 0,
            pointRadius: 0
          }]
        },
        options: {
          responsive: false,
          scales: {
            x: {
              type: 'linear',
              position: 'bottom',
              title: {
                display: true,
                text: 'Extension L (cm)'
              },
              min: 0,
              max: MAX_L,
              ticks: {stepSize: 2 },
            },
            y: {
              title: {
                display: true,
                text: 'Force F (N)'
              },
              min: 0,
              ticks: {stepSize: 2}
            }
          },
          plugins: {
            legend: { display: false },
            title: {
              display: true,
              text: 'Force vs. Extension Graph'
            }
          }
        }
      });
    }
    // Function to draw an oscilloscope‐style sine wave trace
function drawOscilloscopeChart(canvasId, cycles, timeBase) {
  const totalDivisions = 10;                        
  const totalTime      = timeBase * totalDivisions; 
  const period         = totalTime / cycles;        
  const N              = 5;    // minor‐step subdivisions per major division

  const canvas   = document.getElementById(canvasId);
  const ctx      = canvas.getContext('2d');
  const samples  = 600;
  const dataPoints = [];
  for (let i = 0; i <= samples; i++) {
    const t = (i / samples) * totalTime;
    const y = Math.sin(2 * Math.PI * t / period);
    dataPoints.push({ x: t, y: y });
  }

  new Chart(ctx, {
    type: 'line',
    data: {
      datasets: [{ data: dataPoints, pointRadius: 0, borderWidth: 2, fill: false, tension: 0 }]
    },
    options: {
      responsive: false,
      scales: {
        x: {
          type: 'linear',
          title: { display: true, text: 'Div' },
          min: 0,
          max: totalTime,

          // 1) Draw ticks every (timeBase ÷ N) ms → minor + major lines
          ticks: {
            stepSize: timeBase / N,
            autoSkip: false,
            maxTicksLimit: totalDivisions * N + 1,

            // 2) Label only whole‐division lines (0,1,2,3…)
            callback: value => {
              const divCount = value / timeBase;
              return Number.isInteger(divCount) ? divCount : '';
            }
          },

          // 3) Colour major vs minor differently (optional)
          grid: {
            drawOnChartArea: true,
            color: ctx => {
              const divCount = ctx.tick.value / timeBase;
              return Number.isInteger(divCount)
                ? 'rgba(0,0,0,0.3)'   // major (darker)
                : 'rgba(200,0,0,0.1)'; // minor (lighter)
            },
            lineWidth: ctx =>
              Number.isInteger(ctx.tick.value / timeBase) ? 1.5 : 0.5
          }
        },
        y: {
          title: { display: true, text: 'Voltage (arb. units)' },
          min: -1.2,
          max:  1.2,
          ticks: { stepSize: 1 },
          grid:  { drawOnChartArea: true, lineWidth: 1 }
        }
      },
      plugins: {
        legend: { display: false },
        title:  { display: true, text: 'Oscilloscope Trace' }
      }
    }
  });
}



 /* ----------------------------- */


    /* -----------------------------
       Topic Arrays
    ----------------------------- */
    // Topic 1: Physical Quantities and Units
    const additionalQuestionsTopic1 = [
      {
        topic: 1,
        difficulty: "easy",
        type: "numeric_multi",
        question: function() {
          const km = (Math.random() * 10 + 5).toFixed(1);
          const m = (km * 1000).toFixed(0);
          const cm = (km * 100000).toFixed(0);
          return {
            text: `A runner completes a race of ${km} km. Express this distance in both meters and centimeters. Explain your conversion process.`,
            answer: [m + " m", cm + " cm"],
            modelAnswer: [
              `Since 1 km = 1000 m, ${km} km equals ${m} m.`,
              `Also, 1 km = 100,000 cm, so ${km} km equals ${cm} cm.`
            ]
          };
        }
      },
      {
        topic: 1,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const F = (Math.random() * 900 + 100).toFixed(0);
          const dynes = (F * 1e5).toFixed(0);
          return {
            text: `Convert a force of ${F} N into dynes. Explain the conversion factor used.`,
            answer: dynes + " dynes",
            modelAnswer: `1 N = 10^5 dynes, so ${F} N equals ${dynes} dynes.`
          };
        }
      },
      {
        topic: 1,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const densitySI = (Math.random() * 1000 + 500).toFixed(0);
          const densityCGS = (densitySI / 1000).toFixed(3);
          return {
            text: `A substance has a density of ${densitySI} kg/m³. Convert this density to g/cm³. Explain the conversion.`,
            answer: densityCGS + " g/cm³",
            modelAnswer: `Since 1 kg/m³ = 0.001 g/cm³, multiplying ${densitySI} by 0.001 gives ${densityCGS} g/cm³.`
          };
        }
      },
      {
        topic: 1,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const V = (Math.random() * 450 + 50).toFixed(0);
          const dV = (V * (Math.random() * 0.1 + 0.01)).toFixed(1);
          const percent = ((dV / V) * 100).toFixed(1);
          return {
            text: `A measurement yields a value of ${V} with an absolute uncertainty of ${dV}. Calculate the percentage uncertainty. Explain the calculation.`,
            answer: percent + " %",
            modelAnswer: `Percentage uncertainty = (ΔV / V) × 100 = (${dV} / ${V}) × 100 ≈ ${percent} %.`
          };
        }
      },
      {
        topic: 1,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const C = (Math.random() * 60 - 20).toFixed(1);
          const K = (parseFloat(C) + 273.15).toFixed(2);
          return {
            text: `Convert a temperature of ${C} °C to Kelvin. Explain the conversion formula.`,
            answer: K + " K",
            modelAnswer: `To convert °C to K, add 273.15. Thus, ${C} °C becomes ${K} K.`
          };
        }
      },
      {
        topic: 1,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const km = (Math.random() * (10 - 1) + 1).toFixed(3);  // 1.0 up to (but not including) 10.0
const m  = (km * 1000).toFixed(0);       // convert to metres, no decimals

          return { 
            text: `Convert ${km} km to meters.`,
            answer: m,
            modelAnswer: `1 km = 1000 m; thus, ${km} km = ${m} m.`
          };
        }
      },
      {
        topic: 1,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const grams =  Math.floor(Math.random() * 9001) + 1000;
          const kg = (grams / 1000).toFixed(3);
          return { 
            text: `Express ${grams} g in kilograms.`,
            answer: kg,
            modelAnswer: `1 kg = 1000 g; therefore, ${grams} g = ${kg} kg.`
          };
        }
      },
      {
        topic: 1,
        difficulty: "hard",
        type: "equation",
        question: function() {
          const km = (Math.random() * (100 - 10) + 10).toFixed(0);
         const hr = (Math.random() * (10 - 1) + 1).toFixed(1); 
           const mps = ((parseFloat(km) * 1000) / (parseFloat(hr) * 3600)).toFixed(2);
          return {
    text: `A car travels ${km} km in ${hr} hour. What is its speed in m/s?`,
    answer: mps,
    modelAnswer: `Speed = ( ${km}×1000 m ) / ( ${hr}×3600 s ) ≈ ${mps} m/s.`
  };
}
      },
      {
        topic: 1,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const mass_g = (Math.random() * (100000 - 2000) + 2000).toFixed(0); 
          const volume_cm3 = (Math.random() * (50000 - 500) + 500).toFixed(0);
          const density = ((mass_g / 1000) / (volume_cm3 / 1e6)).toFixed(0);
          return { 
            text: `A substance has ${mass_g} g and occupies ${volume_cm3} cm³. Calculate its density in kg/m³.`,
            answer: density + " kg/m³",
            modelAnswer: `Density = (mass in kg)/(volume in m³) = (${mass_g/1000} kg)/(${volume_cm3/1e6} m³) ≈ ${density} kg/m³.`
          };
        }
      },
      {
        topic: 1,
        difficulty: "easy",
        type: "definition",
        question: "Define a scalar quantity.",
        modelAnswer: "A scalar quantity is described only by its magnitude.",
        keywords: [["magnitude", "size", "value"], ["no direction", "directionless"]]
      },
      {
        topic: 1,
        difficulty: "easy",
        type: "definition",
        question: "Define a vector quantity.",
        modelAnswer: "A vector quantity has both magnitude and direction.",
        keywords: [["magnitude", "size", "value"], ["direction", "oriented"]]
      },
      {
        topic: 1,
        difficulty: "easy",
        type: "definition",
        question: "Define SI base quantity.",
        modelAnswer: "An SI base quantity is defined independently and is used to derive other quantities.",
        keywords: [["independent"], ["derived quantities"]]
      },
      {
        topic: 1,
        difficulty: "easy",
        type: "definition",
        question: "Define random error.",
        modelAnswer: "Random error is the unpredictable variation in measurements due to uncontrolled factors.",
        keywords: [["unpredictable"], ["variation", "fluctuation"]]
      },
      {
        topic: 1,
        difficulty: "easy",
        type: "definition",
        question: "Define systematic error.",
        modelAnswer: "Systematic error is a consistent bias in measurements that skews results in one direction.",
        keywords: [["consistent"], ["bias"]]
      },
      {
        topic: 1,
        difficulty: "easy",
        type: "definition",
        question: "Define precision.",
        modelAnswer: "Precision refers to the closeness of repeated measurements to each other.",
        keywords: [["repeatability"], ["closeness"]]
      },
      {
        topic: 1,
        difficulty: "easy",
        type: "definition",
        question: "Define accuracy.",
        modelAnswer: "Accuracy indicates how close a measured value is to the true or accepted value.",
        keywords: [["true value"], ["correct"]]
      },
      {
        topic: 1,
        difficulty: "easy",
        type: "definition",
        question: "Define absolute uncertainty.",
        modelAnswer: "Absolute uncertainty is the estimated amount by which a measured value may vary.",
        keywords: [["uncertainty"], ["margin"]]
      },
      {
        topic: 1,
        difficulty: "easy",
        type: "definition",
        question: "Explain how to combine uncertainties for multiplication and division.",
        modelAnswer: "For multiplication or division, add the percentage uncertainties of the individual values.",
        keywords: [["percentage uncertainty"], ["combine"]]
      },
      {
        topic: 1,
        difficulty: "hard",
        type: "equation",
        question: function() {
          const length =  (Math.random() * (3.5 - 0.5) + .5).toFixed(1); 
          const uncertainty = (Math.random() * (0.09 - 0.01) + 0.01).toFixed(3);
          const perc = (uncertainty / length) * 100;
          return { 
            text: `An object is measured as ${length} m with an uncertainty of ${uncertainty} m. Calculate the percentage uncertainty.`,
            answer: perc.toFixed(2) + " %",
            modelAnswer: `Percentage uncertainty is calculated by taking the uncertainty in the measurement dividing this by the actual measurement and then multiplying this by 100 to make a percentage = (0.02/1.20)*100 ≈ ${perc.toFixed(2)} %.`
          };
        }
      }
    ];

    // Topic 2: Kinematics
    const additionalQuestionsTopic2 = [
      {
        topic: 2,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const u = Math.floor(Math.random() * 10 + 5);
          const a = Math.floor(Math.random() * 4 + 1);
          const t = Math.floor(Math.random() * 4 + 2);
          const s = (u * t + 0.5 * a * t * t).toFixed(1);
          return { 
            text: `A body starts at ${u} m/s and accelerates at ${a} m/s² for ${t} s. Find its displacement.`,
            answer: s + " m",
            modelAnswer: `Displacement = ut + 0.5at² ≈ ${s} m.`
          };
        }
      },
      {
        topic: 2,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const u = (Math.random() * 10 + 10).toFixed(1);
          const g = 9.81;
          const t_max = (u / g).toFixed(2);
          const h_max = (0.5 * u * u / g).toFixed(2);
          return {
            text: `A ball is thrown vertically upwards with an initial speed of ${u} m/s. Calculate: (a) time to reach maximum height and (b) the maximum height.`,
            answer: [t_max + " s", h_max + " m"],
            modelAnswer: [
              `Time = u / g = ${u} / 9.81 ≈ ${t_max} s.`,
              `Height = 0.5*u²/g ≈ ${h_max} m.`
            ]
          };
        }
      },
      {
        topic: 2,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const h = (Math.random() * 20 + 10).toFixed(1);
          const g = 9.81;
          const t = (Math.sqrt(2 * h / g)).toFixed(2);
          return {
            text: `An object is dropped from ${h} m. Calculate the time to hit the ground.`,
            answer: t + " s",
            modelAnswer: `Time = √(2h/g) = √(2×${h}/9.81) ≈ ${t} s.`
          };
        }
      },
      {
        topic: 2,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const h = (Math.random() * 15 + 5).toFixed(1);
          const g = 9.81;
          const t = (Math.sqrt(2 * h / g)).toFixed(2);
          const u = (Math.random() * 10 + 5).toFixed(1);
          const d = (u * t).toFixed(2);
          return {
            text: `An object is launched horizontally from a ${h} m cliff with speed ${u} m/s. Find (a) time to hit the ground and (b) horizontal distance traveled.`,
            answer: [t + " s", d + " m"],
            modelAnswer: [
              `Time = √(2h/g) ≈ ${t} s.`,
              `Distance = u*t ≈ ${d} m.`
            ]
          };
        }
      },
      {
        topic: 2,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const u = (Math.random() * 20 + 20).toFixed(1);
          const t = (Math.random() * 3 + 2).toFixed(1);
          const a = (u / t).toFixed(2);
          const s = (0.5 * u * t).toFixed(2);
          return {
            text: `A vehicle decelerates from ${u} m/s to rest in ${t} s. Calculate (a) deceleration and (b) distance traveled.`,
            answer: [a + " m/s²", s + " m"],
            modelAnswer: [
              `Deceleration = ${u} / ${t} ≈ ${a} m/s².`,
              `Distance ≈ 0.5 × ${u} × ${t} ≈ ${s} m.`
            ]
          };
        }
      },
      {
        topic: 2,
        difficulty: "hard",
        type: "equation",
        question: function() {
          const u = (Math.random() * 10 + 20).toFixed(1);
          const angle = (Math.random() * 20 + 20).toFixed(1);
          const g = 9.81;
          const range = (u * u * Math.sin(2 * angle * Math.PI / 180) / g).toFixed(2);
          return {
            text: `A projectile is launched at ${u} m/s at ${angle}°. Calculate its horizontal range.`,
            answer: range + " m",
            modelAnswer: `Range = (u²*sin(2θ))/g ≈ ${range} m.`
          };
        }
      },
      {
        topic: 2,
        difficulty: "easy",
        type: "definition",
        question: "Define displacement.",
        modelAnswer: "Displacement is the change in position in a specific direction.",
        keywords: [["displacement"], ["direction"]]
      },
      {
        topic: 2,
        difficulty: "easy",
        type: "definition",
        question: "Define speed.",
        modelAnswer: "Speed is the distance traveled per unit time.",
        keywords: [["distance"], ["time"]]
      },
      {
        topic: 2,
        difficulty: "easy",
        type: "definition",
        question: "Define velocity.",
        modelAnswer: "Velocity is displacement per unit time including direction.",
        keywords: [["change in displacement"], ["per unit time", "divided by time", "/time"]]
      },
      {
        topic: 2,
        difficulty: "easy",
        type: "definition",
        question: "Define acceleration.",
        modelAnswer: "Acceleration is the rate of change of velocity.",
        keywords: [["rate"], ["velocity change"]]
      },
      {
        topic: 2,
        difficulty: "easy",
        type: "definition",
        question: "State what the gradient of a displacement–time graph represents.",
        modelAnswer: "It represents velocity.",
        keywords: [["velocity"]]
      },
      {
        topic: 2,
        difficulty: "easy",
        type: "definition",
        question: "State what the gradient of a velocity–time graph represents.",
        modelAnswer: "It represents acceleration.",
        keywords: [["acceleration"]]
      },
      {
        topic: 2,
        difficulty: "easy",
        type: "definition",
        question: "State what the area under a velocity–time graph represents.",
        modelAnswer: "It represents displacement.",
        keywords: [["displacement"]]
      }
    ];

    // Topic 3: Dynamics
    const additionalQuestionsTopic3 = [
      {
        topic: 3,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const m = (Math.random() * 20 + 10).toFixed(1);
          const F = (Math.random() * 100 + 50).toFixed(1);
          const f = (Math.random() * F * 0.5).toFixed(1);
          const netForce = F - f;
          const a = (netForce / m).toFixed(2);
          return {
            text: `A force of ${F} N is applied to a ${m} kg object while friction of ${f} N opposes it. Calculate the net acceleration.`,
            answer: a + " m/s²",
            modelAnswer: `Net force = ${F} N - ${f} N = ${netForce} N, so a = ${netForce} / ${m} ≈ ${a} m/s².`
          };
        }
      },
      {
        topic: 3,
        difficulty: "hard",
        type: "numeric_multi",
        question: function() {
          const m1 = (Math.random() * 5 + 1).toFixed(1);
          const m2 = (Math.random() * 5 + 1).toFixed(1);
          const u1 = (Math.random() * 10 + 5).toFixed(1);
          const u2 = (Math.random() * 10).toFixed(1);
          const v1 = (((m1 - m2) / (parseFloat(m1) + parseFloat(m2))) * u1 + ((2 * m2) / (parseFloat(m1) + parseFloat(m2))) * u2).toFixed(2);
          return {
            text: `Two objects (masses ${m1} kg and ${m2} kg) moving at ${u1} m/s and ${u2} m/s collide elastically. Find the final speed of the ${m1} kg object.`,
            answer: v1 + " m/s",
            modelAnswer: `Using conservation laws, v₁ = [(m₁−m₂)/(m₁+m₂)]×u₁ + [2m₂/(m₁+m₂)]×u₂ ≈ ${v1} m/s.`
          };
        }
      },
      {
        topic: 3,
        difficulty: "easy",
        type: "numeric_multi",
        question: function() {
          const m1 = (Math.random() * 10 + 5).toFixed(1);
          const m2 = (Math.random() * 10 + 5).toFixed(1);
          const u1 = (Math.random() * 10 + 10).toFixed(1);
          const u2 = (Math.random() * 5).toFixed(1);
          const finalV = ((m1 * u1 + m2 * u2) / (parseFloat(m1) + parseFloat(m2))).toFixed(2);
          return {
            text: `A ${m1} kg object moving at ${u1} m/s collides inelastically with a ${m2} kg object at ${u2} m/s. Find their common final velocity.`,
            answer: finalV + " m/s",
            modelAnswer: `v = (m1*u1 + m2*u2) / (m1 + m2) ≈ ${finalV} m/s.`
          };
        }
      },
      {
        topic: 3,
        difficulty: "hard",
        type: "equation",
        question: function() {
          const F = (Math.random() * 20 + 10).toFixed(1);
          const r = (Math.random() * 0.5 + 0.5).toFixed(2);
          const I = (Math.random() * 2 + 1).toFixed(2);
          const torque = (F * r).toFixed(2);
          const alpha = (torque / I).toFixed(2);
          return {
            text: `A force of ${F} N is applied perpendicularly at ${r} m from the axis of an object (I = ${I} kg·m²). Calculate the angular acceleration.`,
            answer: alpha + " rad/s²",
            modelAnswer: `Torque = ${F}×${r} ≈ ${torque} N·m; then α = ${torque} / ${I} ≈ ${alpha} rad/s².`
          };
        }
      },
      {
        topic: 3,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const m = (Math.random() * 20 + 5).toFixed(1);
          const angle = (Math.random() * 20 + 10).toFixed(1);
          const d = (Math.random() * 10 + 2).toFixed(1);
          const g = 9.8;
          const a = (g * Math.sin(angle * Math.PI / 180)).toFixed(2);
          const v = (Math.sqrt(2 * a * d)).toFixed(2);
          return {
            text: `A ${m} kg block slides down a ${angle}° frictionless slope for ${d} m. Find its speed at the bottom.`,
            answer: v + " m/s",
            modelAnswer: `Acceleration ≈ ${a} m/s²; speed ≈ ${v} m/s.`
          };
        }
      },
      {
        topic: 3,
        difficulty: "hard",
        type: "numeric_multi",
        question: function() {
          const mass = 20, angle = 23, distance = 5, g = 9.8;
          const a = g * Math.sin(angle * Math.PI / 180);
          const v = Math.sqrt(2 * a * distance);
          const ke = 0.5 * mass * v * v;
          return {
            text: `A ${mass} kg block slides down a ${angle}° slope for ${distance} m. Calculate: (a) acceleration, (b) final speed, and (c) kinetic energy.`,
            answer: [a.toFixed(2) + " m/s²", v.toFixed(2) + " m/s", ke.toFixed(2) + " J"],
            modelAnswer: [
              `a ≈ ${a.toFixed(2)} m/s²,`,
              `v ≈ ${v.toFixed(2)} m/s,`,
              `KE ≈ ${ke.toFixed(2)} J.`
            ]
          };
        }
      },
      {
        topic: 3,
        difficulty: "easy",
        type: "definition",
        question: "State Newton’s First Law of Motion.",
        modelAnswer: "A body remains at rest or in uniform motion unless acted upon by a net force.",
        keywords: [["rest"], ["uniform motion"], ["net force"]]
      },
      {
        topic: 3,
        difficulty: "easy",
        type: "definition",
        question: "State what is meant by the centre of gravity of an object.",
        modelAnswer: "The point where all the weight of an object appears to act.",
        keywords: [["point", "location", "place"], ["weight"], ["act", "work", "occur"]]
      },
      {
        topic: 3,
        difficulty: "easy",
        type: "definition",
        question: "State Newton’s Second Law of Motion.",
        modelAnswer: "The force on an object is proportional to the rate of change of its momentum.",
        keywords: [["momentum change"], ["force"]]
      },
      {
        topic: 3,
        difficulty: "easy",
        type: "definition",
        question: "State Newton’s Third Law of Motion.",
        modelAnswer: "For every action, there is an equal and opposite reaction.",
        keywords: [["action"], ["reaction"]]
      },
      {
        topic: 3,
        difficulty: "easy",
        type: "definition",
        question: "Define inertia.",
        modelAnswer: "Inertia is the tendency of an object to resist a change in its state of motion.",
        keywords: [["resist change"], ["motion"]]
      }
    ];

    // Topic 4: Forces, Density and Pressure
    const additionalQuestionsTopic4 = [
      {
        topic: 4,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const h = (Math.random() * 10 + 5).toFixed(1);
          const rho = 1000, g = 9.81;
          const pressure = (rho * g * h).toFixed(0);
          return {
            text: `Calculate the hydrostatic pressure at a depth of ${h} m in water.`,
            answer: pressure + " Pa",
            modelAnswer: `Pressure = ρgh ≈ ${pressure} Pa.`
          };
        }
      },
      {
        topic: 4,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const A = (Math.random() * 1000 + 500).toFixed(0);
          const h = (Math.random() * 4 + 2).toFixed(1);
          const rho = 1000, g = 9.81;
          const A_m2 = A / 10000;
          const force = (rho * g * h * A_m2).toFixed(1);
          return {
            text: `A container with a base area of ${A} cm² is filled with water to a height of ${h} m. Calculate the force on its base.`,
            answer: force + " N",
            modelAnswer: `Force = ρgh×(A in m²) ≈ ${force} N.`
          };
        }
      },
      {
        topic: 4,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const V = (Math.random() * 500 + 100).toFixed(0);
          const rho = 1000, g = 9.81;
          const V_m3 = V / 1e6;
          const buoyant = (rho * g * V_m3).toFixed(2);
          return {
            text: `An object displaces ${V} cm³ of water. Calculate its buoyant force using Archimedes' principle.`,
            answer: buoyant + " N",
            modelAnswer: `Buoyant force = ρgV. Here, V = ${V} cm³, so force ≈ ${buoyant} N.`
          };
        }
      },
      {
        topic: 4,
        difficulty: "hard",
        type: "numeric_multi",
        question: function() {
          const V_g = (Math.random() * 60 + 20).toFixed(0);
          const d_g = 1.3, d_w = 1.0, d_mix = 1.1;
          const V_w = (((d_g - d_mix) / (d_mix - d_w)) * V_g).toFixed(1);
          return {
            text: `A student has ${V_g} cm³ of glycerine (density = 1.3 g/cm³). How much water (density = 1.0 g/cm³) must be added to get a mixture density of 1.1 g/cm³?`,
            answer: V_w + " cm³",
            modelAnswer: `Using the mixing formula, V_w = 2×V_g. So if V_g = ${V_g} cm³, then V_w ≈ ${V_w} cm³.`
          };
        }
      },
      {
        topic: 4,
        difficulty: "hard",
        type: "equation",
        question: function() {
          const F_small = (Math.random() * 200 + 100).toFixed(0);
          const A_small = (Math.random() * 50 + 50).toFixed(0);
          const A_large = (Math.random() * 200 + 100).toFixed(0);
          const F_large = (F_small * (A_large / A_small)).toFixed(1);
          return {
            text: `In a hydraulic press, if ${F_small} N is applied on a small piston of area ${A_small} cm², what is the force on a large piston of area ${A_large} cm²?`,
            answer: F_large + " N",
            modelAnswer: `F_large = F_small×(A_large/A_small) ≈ ${F_large} N.`
          };
        }
      },
      {
        topic: 4,
        difficulty: "easy",
        type: "definition",
        question: "Define pressure.",
        modelAnswer: "Pressure is the force per unit area.",
        keywords: [["force"], ["area"]]
      },
      {
        topic: 4,
        difficulty: "easy",
        type: "definition",
        question: "Define density.",
        modelAnswer: "Density is the mass per unit volume of a substance.",
        keywords: [["mass"], ["volume"]]
      },
      {
        topic: 4,
        difficulty: "hard",
        type: "numeric_multi",
        question: function() {
          const area_cm2 = 500, height = 2.5, rho = 1000, g = 9.8;
          const area_m2 = area_cm2 / 10000;
          const pressure = rho * g * height;
          const extra = 0.1 * pressure;
          const extraForce = extra * area_m2;
          return { 
            text: `For a container with a base area of ${area_cm2} cm² and water height of ${height} m, calculate: (a) hydrostatic pressure and (b) the extra force for a 10% pressure increase.`,
            answer: [pressure.toFixed(0) + " Pa", extraForce.toFixed(2) + " N"],
            modelAnswer: [
              `Pressure = ρgh ≈ ${pressure.toFixed(0)} Pa,`,
              `Extra force ≈ ${extraForce.toFixed(2)} N.`
            ]
          };
        }
      }
    ];

    // Topic 5: Work, Energy and Power
    const additionalQuestionsTopic5 = [
      {
        topic: 5,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const m = (Math.random() * 10 + 5).toFixed(1);
          const h = (Math.random() * 10 + 5).toFixed(1);
          const g = 9.81;
          const GPE = (m * g * h).toFixed(1);
          return {
            text: `Calculate the gravitational potential energy of a ${m} kg object raised to ${h} m.`,
            answer: GPE + " J",
            modelAnswer: `GPE = mgh ≈ ${GPE} J.`
          };
        }
      },
      {
        topic: 5,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const W = (Math.random() * 500 + 200).toFixed(0);
          const t = (Math.random() * 10 + 5).toFixed(1);
          const P = (W / t).toFixed(1);
          return {
            text: `If ${W} J of work is done in ${t} s, calculate the power output.`,
            answer: P + " W",
            modelAnswer: `Power = Work/Time ≈ ${P} W.`
          };
        }
      },
      {
        topic: 5,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const k = (Math.random() * 200 + 100).toFixed(0);
          const x = (Math.random() * 0.1 + 0.05).toFixed(3);
          const energy = (0.5 * k * x * x).toFixed(3);
          return {
            text: `A spring with constant ${k} N/m is compressed by ${x} m. Calculate the stored energy.`,
            answer: energy + " J",
            modelAnswer: `Energy = 0.5×k×x² ≈ ${energy} J.`
          };
        }
      },
      {
        topic: 5,
        difficulty: "hard",
        type: "equation",
        question: function() {
          const F = (Math.random() * 50 + 50).toFixed(0);
          const d = (Math.random() * 10 + 5).toFixed(1);
          const reduction = (Math.random() * 0.3 + 0.2).toFixed(2);
          const effectiveForce = (F * (1 - reduction)).toFixed(1);
          const work = (effectiveForce * d).toFixed(1);
          return {
            text: `A force of ${F} N acts over ${d} m, but friction reduces the force by ${(reduction * 100).toFixed(0)}%. Calculate the net work done.`,
            answer: work + " J",
            modelAnswer: `Effective force ≈ ${effectiveForce} N, so work ≈ ${work} J.`
          };
        }
      },
      {
        topic: 5,
        difficulty: "hard",
        type: "equation",
        question: function() {
          const m = (Math.random() * 5 + 1).toFixed(1);
          const h = (Math.random() * 10 + 5).toFixed(1);
          const g = 9.81;
          const v = (Math.sqrt(2 * g * h)).toFixed(2);
          return {
            text: `An object of ${m} kg is dropped from ${h} m. Calculate its impact speed using energy conservation.`,
            answer: v + " m/s",
            modelAnswer: `v = √(2gh) ≈ ${v} m/s.`
          };
        }
      },
      {
        topic: 5,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const m = Math.floor(Math.random() * 10 + 1);
          const v = Math.floor(Math.random() * 10 + 1);
          const KE = (0.5 * m * v * v).toFixed(1);
          return { 
            text: `Calculate the kinetic energy of a ${m} kg object moving at ${v} m/s.`,
            answer: KE,
            modelAnswer: `KE ≈ ${KE} J.`
          };
        }
      },
      {
        topic: 5,
        difficulty: "easy",
        type: "definition",
        question: "State what is meant by the work done by a force.",
        modelAnswer: "Work is done when a force causes an object to move in its direction.",
        keywords: [["force"], ["movement"]]
      },
      {
        topic: 5,
        difficulty: "easy",
        type: "definition",
        question: "Define power.",
        modelAnswer: "Power is the rate of doing work or transferring energy.",
        keywords: [["rate"], ["work"], ["energy"]]
      },
      {
        topic: 5,
        difficulty: "easy",
        type: "definition",
        question: "Use the definition of power to determine its SI units.",
        modelAnswer: "Power in SI units is kg·m²/s³.",
        keywords: [["kg"], ["m²"], ["s³"]]
      },
      {
        topic: 5,
        difficulty: "easy",
        type: "definition",
        question: "Use the definition of work to determine its SI units.",
        modelAnswer: "Work in SI units is kg·m²/s².",
        keywords: [["kg"], ["m²"], ["s²"]]
      },
      {
        topic: 5,
        difficulty: "easy",
        type: "definition",
        question: "Use the definition of force (F = m·a) to determine its SI units.",
        modelAnswer: "Force in SI units is kg·m/s².",
        keywords: [["kg"], ["m/s²"]]
      },
      {
        topic: 5,
        difficulty: "easy",
        type: "definition",
        question: "Use the definition of pressure (P = F/A) to determine its SI units.",
        modelAnswer: "Pressure in SI units is kg/(m·s²).",
        keywords: [["kg"], ["m"], ["s²"]]
      },
      {
        topic: 5,
        difficulty: "easy",
        type: "definition",
        question: "Use the definition of momentum (p = m·v) to determine its SI units.",
        modelAnswer: "Momentum in SI units is kg·m/s.",
        keywords: [["kg"], ["m/s"]]
      },
      {
        topic: 5,
        difficulty: "easy",
        type: "definition",
        question: "Use the definition of strain to determine its SI units.",
        modelAnswer: "Strain is dimensionless.",
        keywords: [["dimensionless"]]
      },
      {
        topic: 5,
        difficulty: "hard",
        type: "numeric_multi",
        question: function() {
          const Vin = 9.0, R_fixed = 1800, V_fixed = 5.4;
          const I = V_fixed / R_fixed;
          const V_LDR = Vin - V_fixed;
          const R_LDR = V_LDR / I;
          return { 
            text: `A ${Vin} V battery is connected in series with an LDR and a ${R_fixed} Ω resistor. The voltmeter reads ${V_fixed} V. Calculate (a) the current and (b) the LDR resistance.`,
            answer: [I.toFixed(3) + " A", R_LDR.toFixed(0) + " Ω"],
            modelAnswer: [
              `Current I ≈ ${I.toFixed(3)} A.`,
              `LDR resistance ≈ ${R_LDR.toFixed(0)} Ω.`
            ]
          };
        }
      }
    ];

    // Topic 6: Deformation of Solids
    const additionalQuestionsTopic6 = [
      {
        topic: 6,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const kVal = (Math.random() * 200 + 100).toFixed(0);
          const F = (Math.random() * 50 + 20).toFixed(0);
          const extension = (F / kVal).toFixed(3);
          return {
            text: `A spring with constant ${kVal} N/m is pulled with a force of ${F} N. Calculate its extension.`,
            answer: extension + " m",
            modelAnswer: `Using Hooke's law, x = F/k ≈ ${extension} m.`
          };
        }
      },
      {
        topic: 6,
        difficulty: "hard",
        type: "equation",
        question: function() {
          const L = (Math.random() * 100 + 50).toFixed(0);
          const A = (Math.random() * 0.001 + 0.0005).toFixed(6);
          const F = (Math.random() * 1000 + 500).toFixed(0);
          const E = 200e9;
          const strain = F / (E * A);
          const extension = ((L / 100) * strain).toFixed(6);
          return {
            text: `A rod (${L} cm long, area ${A} m²) is under a force of ${F} N. With E = 200 GPa, calculate its extension.`,
            answer: extension + " m",
            modelAnswer: `Extension = (L/100) × (F/(E*A)) ≈ ${extension} m.`
          };
        }
      },
        {
    topic: 6,
    difficulty: "easy",
    type: "numeric_multi",  // changed type to numeric_multi
    question: function() {
      // Generate a dynamic spring constant k (in N/cm) between 0.3 and 0.5
      const k_num = 0.3 + Math.random() * 0.2; 
      // Generate a dynamic x-intercept L0 between 0 and 5 cm
      const L0 = Math.random() * 5;
      // Generate a dynamic applied force (in N) for part (b)
      const F_applied = Number((Math.random() * 10 + 10).toFixed(0));
      
      // Part (a): The spring constant answer (displayed in N/cm)
      const answerPart1 = (k_num*100).toFixed(2) + " N/m";
      
      // Part (b):
      // Calculate extension in cm: x_cm = F_applied / k_num.
      // Convert extension to meters: x_m = x_cm / 100.
      // Convert spring constant to SI units: k_SI = k_num * 100 (N/m).
      // Then, elastic energy E = ½ * k_SI * (x_m)².
      const x_cm = F_applied / k_num;
      const x_m = x_cm / 100;
      const k_SI = k_num * 100;
      const energy = 0.5 * k_SI * (x_m * x_m);
      const answerPart2 = energy.toFixed(2) + " J";
      
      const answerCombined = [answerPart1, answerPart2];
      
      // Model answers:
      const modelAnswerPart1 = `Answer (a): Using Hooke's Law, F = kx, we can use the gradient of the graph to give k, however, you must make sure you do rise over run and not just take one data point as the graph does not go throught the origin. For this graph, k = ${(k_num*100).toFixed(2)} N/m.`;
      const modelAnswerPart2 = `Answer (b): With F = ${F_applied} N, the extension is x = F/k = ${x_cm.toFixed(2)} cm (${x_m.toFixed(4)} m). Converting k to SI units gives k = ${k_SI.toFixed(2)} N/m so the elastic potential energy is E = ½·k·x² ≈ ${energy.toFixed(2)} J.`;
      
      const modelAnswerCombined = [modelAnswerPart1, modelAnswerPart2];
      
      // Create a unique canvas ID for the dynamic chart
      const canvasId = "springChart_" + Math.floor(Math.random() * 100000);
      // Build the HTML for the graph
      const imageHtml = `<canvas id="${canvasId}" width="600" height="400"></canvas>`;
      
      // Delay drawing the chart to ensure the canvas is in the DOM
      setTimeout(() => {
        drawSpringChart(canvasId, k_num, L0);
      }, 700);
      
      return {
        text: `A force vs. extension graph for a spring is shown below. 
(a) Determine the spring constant k from the graph.
(b) Determine the elastic potential energy stored when the applied force is ${F_applied} N.`,
        answer: answerCombined,
        modelAnswer: modelAnswerCombined,
        image: imageHtml
      };
    }
  },

      {
        topic: 6,
        difficulty: "hard",
        type: "equation",
        question: function() {
          const F = (Math.random() * 500 + 100).toFixed(0);
          const k_approx = (Math.random() * 100 + 200).toFixed(0);
          const x = (F / k_approx).toFixed(3);
          const energy = (0.5 * F * x).toFixed(2);
          return {
            text: `If a material with stiffness ${k_approx} N/m is extended by a force of ${F} N (extension = ${x} m), calculate its stored energy.`,
            answer: energy + " J",
            modelAnswer: `Elastic energy = 0.5×F×x ≈ ${energy} J.`
          };
        }
      },
      {
        topic: 6,
        difficulty: "easy",
        type: "definition",
        question: "Define Young's modulus and its significance.",
        modelAnswer: "Young's modulus is the ratio of stress to strain in the elastic range and indicates material stiffness.",
        keywords: [["stiffness"], ["stress"], ["strain"]]
      },
      {
        topic: 6,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const deltaL = (Math.random() * 0.05 + 0.01).toFixed(3);
          const L0 = (Math.random() * 1 + 1).toFixed(2);
          const strain = (deltaL / L0).toFixed(3);
          return {
            text: `A rod of length ${L0} m is extended by ${deltaL} m. Calculate its strain.`,
            answer: strain,
            modelAnswer: `Strain = ΔL / L₀ ≈ ${strain} (dimensionless).`
          };
        }
      },
      {
        topic: 6,
        difficulty: "easy",
        type: "definition",
        question: "State Hooke's Law.",
        modelAnswer: "Within the elastic limit, extension is directly proportional to the applied force.",
        keywords: [["proportional"], ["force"]]
      },
      {
        topic: 6,
        difficulty: "easy",
        type: "definition",
        question: "Define stress.",
        modelAnswer: "Stress is force per unit area of a material.",
        keywords: [["force"], ["area"]]
      },
      {
        topic: 6,
        difficulty: "easy",
        type: "definition",
        question: "Define strain.",
        modelAnswer: "Strain is the ratio of change in length to the original length.",
        keywords: [["ratio"], ["change"], ["original length"]]
      },
      {
        topic: 6,
        difficulty: "hard",
        type: "numeric_multi",
        question: function() {
          const length = 2, area = 1e-4, force = 10000, E = 200e9;
          const stress = force / area;
          const strain = stress / E;
          const elongation = length * strain;
          return { 
            text: `A rod (${length} m long, area ${area} m²) is subjected to ${force} N with E = ${E / 1e9} GPa. Calculate: (a) stress, (b) strain, (c) elongation.`,
            answer: [stress.toExponential(2) + " Pa", strain.toExponential(2), elongation.toExponential(2) + " m"],
            modelAnswer: [
              `Stress ≈ ${stress.toExponential(2)} Pa,`,
              `Strain ≈ ${strain.toExponential(2)},`,
              `Elongation ≈ ${elongation.toExponential(2)} m.`
            ]
          };
        }
      }
    ];

    // Topic 7: Waves (non-standing wave problems)
    const additionalQuestionsTopic7 = [
      {
        topic: 7,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const T = (Math.random() * 20 + 50).toFixed(1);
          const mu = (Math.random() * 0.005 + 0.005).toFixed(4);
          const v = Math.sqrt(T / mu).toFixed(2);
          return {
            text: `A wave travels along a string under ${T} N tension with linear density ${mu} kg/m. Find its speed.`,
            answer: v + " m/s",
            modelAnswer: `Speed = √(T/μ) ≈ ${v} m/s.`
          };
        }
      },
      {
        topic: 7,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const v = (Math.random() * 50 + 300).toFixed(1);
          const f = (Math.random() * 10 + 50).toFixed(1);
          const lambda = (v / f).toFixed(2);
          return {
            text: `A sound wave has speed ${v} m/s and frequency ${f} Hz. Calculate its wavelength.`,
            answer: lambda + " m",
            modelAnswer: `λ = v / f ≈ ${lambda} m.`
          };
        }
      },
      {
        topic: 7,
        difficulty: "hard",
        type: "equation",
        question: function() {
          const f0 = (Math.random() * 10 + 400).toFixed(1);
          const v = 340;
          const vs = (Math.random() * 10 + 10).toFixed(1);
          const f_obs = (f0 * (v / (v - vs))).toFixed(1);
          return {
            text: `A source emitting ${f0} Hz moves towards an observer at ${vs} m/s. Calculate the observed frequency.`,
            answer: f_obs + " Hz",
            modelAnswer: `Using Doppler: f ≈ ${f0}×(340/(340−${vs})) ≈ ${f_obs} Hz.`
          };
        }
      },
      {
        topic: 7,
        difficulty: "easy",
        type: "definition",
        question: "Define wavelength.",
        modelAnswer: "Wavelength is the distance between successive in-phase points on a wave.",
        keywords: [["distance"], ["in phase"]]
      },
      {
        topic: 7,
        difficulty: "easy",
        type: "definition",
        question: "Define frequency.",
        modelAnswer: "Frequency is the number of oscillations per second.",
        keywords: [["oscillations"], ["Hz"]]
      },
      {
        topic: 7,
        difficulty: "easy",
        type: "definition",
        question: "Define wavefront.",
        modelAnswer: "A wavefront is a line joining points on a wave that are in phase.",
        keywords: [["line"], ["in phase"]]
      },
      {
  topic: 7,
  difficulty: "easy",
  type: "equation",
  question: function() {
    const timeBase = [1, 2, 5][Math.floor(Math.random() * 3)];  // ms/div
    const cycles  = Math.floor(Math.random() * 2) + 3;         // number of compete waves
    const totalDivisions = 10;                                 // typical screen width in divisions
const totalTime      = timeBase * totalDivisions;         // total time across screen (ms)
const period         = totalTime / cycles;                // ms per cycle
    const canvasId = "oscChart_" + Math.floor(Math.random() * 1e5);
    const imageHtml = `<canvas id="${canvasId}" width="600" height="300"></canvas>`;
    setTimeout(() => {drawOscilloscopeChart(canvasId, cycles, timeBase);
    }, 100);
    return {
text: `The oscilloscope below is set to ${timeBase} ms/division. Determine the wave’s period in ms.`,
      answer: period.toFixed(1) + " ms",
      modelAnswer: `Time period is the time for 1 whole waves. To do this fine two points on the graph that you can count the number of divisions. Times this by the time base. Then divide that number by the how many waves (or parts of a wave the two points are apart. T = (10 × ${timeBase} ms) / ${cycles} ≈ ${period.toFixed(1)} ms.`,
      image: imageHtml
    };
  }
}

    ];
    

    // Topic 8: Superposition (including standing wave questions)
    const additionalQuestionsTopic8 = [
      {
        topic: 8,
        difficulty: "easy",
        type: "definition",
        question: "State the principle of superposition.",
        modelAnswer: "When waves overlap, the net displacement is the sum of the individual displacements.",
        keywords: [["sum", "add or subtract"], ["displacement"]]
      },
      {
        topic: 8,
        difficulty: "easy",
        type: "definition",
        question: "Define constructive interference.",
        modelAnswer: "Constructive interference occurs when waves in phase add together to increase displacement.",
        keywords: [["in phase"], ["displacement", "amplitude"], ["add", "increase"]]
      },
      {
        topic: 8,
        difficulty: "easy",
        type: "definition",
        question: "Define destructive interference.",
        modelAnswer: "Destructive interference occurs when waves out of phase cancel each other causing the resultant displacement to be lower.",
        keywords: [["out of phase"], ["cancel","less", "reduce", "lower"]]
      },
      {
        topic: 8,
        difficulty: "hard",
        type: "numeric_multi",
        question: function() {
          const n = Math.floor(Math.random() * 3 + 1);
          const L = Math.floor(Math.random() * 3 + 1);
          const v = Math.floor(Math.random() * 200 + 100);
          const f = (n * v) / (2 * L);
          return { 
            text: `A pipe closed at both ends of length ${L} m vibrates in its ${ordinalSuffix(n)} harmonic. Find its frequency.`,
            answer: f.toFixed(1),
            modelAnswer: `Frequency ≈ ${f.toFixed(1)} Hz using f = n*v/(2L).`
          };
        }
      },
      {
        topic: 8,
        difficulty: "hard",
        type: "numeric_multi",
        question: function() {
          const L = Math.floor(Math.random() * 3 + 1);
          const n = Math.floor(Math.random() * 3 + 1);
          const v = Math.floor(Math.random() * 50 + 330);
          const lambda = (2 * L) / n;
          const f = v / lambda;
          return {
            text: `An open pipe of length ${L} m vibrates in its ${n}${ordinalSuffix(n)} harmonic mode. Calculate (a) the wavelength and (b) the frequency.`,
            answer: [lambda.toFixed(2) + " m", f.toFixed(2) + " Hz"],
            modelAnswer: [
              `λ = 2L/n ≈ ${lambda.toFixed(2)} m,`,
              `f = v/λ ≈ ${f.toFixed(2)} Hz.`
            ]
          };
        }
      },
      {
        topic: 8,
        difficulty: "easy",
        type: "definition",
        question: "A string 8cm long is fixed at both ends. A point on the string is moved downwards and then released. Explain how a standing wave is formed on the string.",
        modelAnswer: "Waves travel along the string and reflect at the fixed ends. The returning wave interferes with the incoming wave, and if their frequencies match, a standing wave is formed.",
        keywords: [["reflect", "bounce"], ["fixed point", "end"], ["two waves"], ["interfere", "standing"]]
      },
      {
        topic: 8,
        difficulty: "hard",
        type: "equation",
        question: function() {
          const d = (Math.random() * 0.5 + 0.2).toFixed(2);
          const v = Math.floor(Math.random() * 50 + 330);
          const f = v / (2 * d);
          return {
            text: `A speaker and wall setup gives loud points spaced ${d} m apart. If sound speed is ${v} m/s, find the frequency.`,
            answer: f.toFixed(2) + " Hz",
            modelAnswer: `Loud point spacing = ½λ, so λ = 2×${d} ≈ ${(2 * d).toFixed(2)} m; f = ${v} / (${2 * d}) ≈ ${f.toFixed(2)} Hz.`
          };
        }
      },
      {
        topic: 8,
        difficulty: "easy",
        type: "definition",
        question: "Define a standing wave.",
        modelAnswer: "A standing wave is formed by two waves traveling in opposite directions with the same frequency and similar amplitude.",
        keywords: [["opposite", "different direction"], ["frequency"], ["amplitude"]]
      }
    ];

    // Topic 9: Electricity
    const additionalQuestionsTopic9 = [
      {
        topic: 9,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const I = Math.floor(Math.random() * 5 + 1);
          const R = Math.floor(Math.random() * 20 + 10);
          const V = I * R;
          return {
            text: `A current of ${I} A flows through a ${R} Ω resistor. Calculate the voltage.`,
            answer: V.toFixed(1),
            modelAnswer: `V = I×R ≈ ${V.toFixed(1)} V.`
          };
        }
      },
      {
        topic: 9,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const V = Math.floor(Math.random() * 20 + 10);
          const I = Math.floor(Math.random() * 5 + 1);
          const P = V * I;
          return {
            text: `With a voltage of ${V} V and current of ${I} A, calculate power.`,
            answer: P.toFixed(1),
            modelAnswer: `Power = V×I ≈ ${P.toFixed(1)} W.`
          };
        }
      },
      {
        topic: 9,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const R1 = Math.floor(Math.random() * 20 + 10);
          const R2 = Math.floor(Math.random() * 20 + 10);
          const R3 = Math.floor(Math.random() * 20 + 10);
          const Rp = 1 / (1 / R1 + 1 / R2);
          const R_total = Rp + R3;
          return {
            text: `Calculate the total resistance when ${R1} Ω and ${R2} Ω resistors are in parallel and in series with a ${R3} Ω resistor.`,
            answer: R_total.toFixed(1),
            modelAnswer: `Parallel: ≈ ${Rp.toFixed(1)} Ω; then total = ${Rp.toFixed(1)} + ${R3} ≈ ${R_total.toFixed(1)} Ω.`
          };
        }
      },
      {
        topic: 9,
        difficulty: "easy",
        type: "definition",
        question: "State Kirchhoff’s first law.",
        modelAnswer: "The sum of currents entering a junction equals the sum of currents leaving the junction.",
        keywords: [["sum"], ["current"], ["junction"]]
      },
      {
        topic: 9,
        difficulty: "easy",
        type: "definition",
        question: "Define electric current.",
        modelAnswer: "Electric current is the rate at which charge flows through a conductor.",
        keywords: [["charge"], ["flow"]]
      },
      {
        topic: 9,
        difficulty: "easy",
        type: "definition",
        question: "Define electromotive force (e.m.f.).",
        modelAnswer: "E.m.f. is the energy provided per unit charge by a source (in volts).",
        keywords: [["energy"], ["charge"]]
      },
      {
        topic: 9,
        difficulty: "easy",
        type: "definition",
        question: "State Kirchhoff’s first law.",
        modelAnswer: "The sum of currents into a junction equals the sum of currents out.",
        keywords: [["sum"], ["current"], ["junction"]]
      },
      {
        topic: 9,
        difficulty: "easy",
        type: "definition",
        question: "Define electric potential difference.",
        modelAnswer: "It is the work done per unit charge between two points.",
        keywords: [["work"], ["charge"], ["points"]]
      },
      {
        topic: 9,
        difficulty: "hard",
        type: "numeric_multi",
        question: function() {
          const R = 10, Vin = 12, I1 = Vin / R, P1 = I1 * I1 * R,
                R_series = 10, newTotal = R + R_series, I2 = Vin / newTotal;
          return {
            text: `A ${R} Ω resistor is connected to ${Vin} V. Calculate: (a) current, (b) power, (c) new current if a ${R_series} Ω resistor is added.`,
            answer: [I1.toFixed(2)+" A", P1.toFixed(1)+" W", I2.toFixed(2)+" A"],
            modelAnswer: [
              `I = ${Vin}/${R} ≈ ${I1.toFixed(2)} A.`,
              `P = I²×R ≈ ${P1.toFixed(1)} W.`,
              `New current ≈ ${I2.toFixed(2)} A.`
            ]
          };
        }
      }
    ];

    // Topic 10: D.C. Circuits
    const additionalQuestionsTopic10 = [
      {
        topic: 10,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const R1 = Math.floor(Math.random() * 50 + 50);
          const R2 = Math.floor(Math.random() * 50 + 50);
          const Vin = Math.floor(Math.random() * 20 + 10);
          const Vout = (Vin * (R2 / (R1 + R2))).toFixed(1);
          return {
            text: `In a voltage divider with ${R1} Ω and ${R2} Ω resistors and Vin = ${Vin} V, find the voltage across the ${R2} Ω resistor.`,
            answer: Vout,
            modelAnswer: `V_out = Vin×(R2/(R1+R2)) ≈ ${Vout} V.`
          };
        }
      },
      {
        topic: 10,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const Vin = Math.floor(Math.random() * 20 + 10);
          const R_total = Math.floor(Math.random() * 100 + 100);
          const I = (Vin / R_total).toFixed(2);
          return {
            text: `Find the current in a series circuit with R_total = ${R_total} Ω and Vin = ${Vin} V.`,
            answer: I,
            modelAnswer: `I = Vin/R ≈ ${I} A.`
          };
        }
      },
      {
        topic: 10,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const I = Math.floor(Math.random() * 5 + 1);
          const R = Math.floor(Math.random() * 100 + 50);
          const P = (I * I * R).toFixed(1);
          return {
            text: `Calculate the power in a ${R} Ω resistor with current ${I} A.`,
            answer: P,
            modelAnswer: `P = I²×R ≈ ${P} W.`
          };
        }
      },
      {
        topic: 10,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const R1 = Math.floor(Math.random() * 50 + 50);
          const R2 = Math.floor(Math.random() * 50 + 50);
          const R3 = Math.floor(Math.random() * 50 + 50);
          const R_total = R1 + R2 + R3;
          return {
            text: `Three resistors of ${R1} Ω, ${R2} Ω, and ${R3} Ω are in series. Find R_total.`,
            answer: R_total.toFixed(1),
            modelAnswer: `R_total = ${R1} + ${R2} + ${R3} = ${R_total} Ω.`
          };
        }
      },
      {
        topic: 10,
        difficulty: "hard",
        type: "numeric_multi",
        question: function() {
          const R1 = 100, R2 = 200, R3 = 300, Vin = 12;
          const R_total = R1 + R2 + R3;
          const I = Vin / R_total;
          const V_R2 = I * R2;
          const power_R2 = (V_R2 * V_R2) / R2;
          return {
            text: `In a series circuit with resistors ${R1} Ω, ${R2} Ω, and ${R3} Ω and Vin = ${Vin} V, calculate: (a) voltage across ${R2} Ω, (b) power dissipated in it.`,
            answer: [V_R2.toFixed(2)+" V", power_R2.toFixed(2)+" W"],
            modelAnswer: [
              `V_R2 = Vin×(R2/R_total) ≈ ${V_R2.toFixed(2)} V.`,
              `Power = V_R2²/R2 ≈ ${power_R2.toFixed(2)} W.`
            ]
          };
        }
      },
      {
        topic: 10,
        difficulty: "easy",
        type: "definition",
        question: "Define resistance.",
        modelAnswer: "Resistance is the ratio of the voltage across a conductor to the current flowing through it.",
        keywords: [["voltage"], ["current"], ["ratio"]]
      },
      {
        topic: 10,
        difficulty: "easy",
        type: "definition",
        question: "Define internal resistance.",
        modelAnswer: "Internal resistance is the resistance inside a power source that causes a terminal voltage drop.",
        keywords: [["internal"], ["power source"], ["resistance"]]
      }
    ];

    // Topic 11: Particle and Nuclear Physics
    const additionalQuestionsTopic11 = [
      {
        topic: 11,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const A = Math.floor(Math.random() * 50 + 200);
          const finalA = A - 4;
          return {
            text: `A nucleus with mass number ${A} undergoes alpha decay. What is its final mass number?`,
            answer: finalA.toString(),
            modelAnswer: `Alpha decay reduces mass number by 4: ${A} → ${finalA}.`
          };
        }
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const Z = Math.floor(Math.random() * 20 + 10);
          const A = Math.floor(Math.random() * 30 + parseFloat(Z) + 10);
          const finalZ = Z + 1;
          return {
            text: `A nucleus with proton number ${Z} and mass number ${A} undergoes beta-minus decay. What is its new proton number?`,
            answer: finalZ.toString(),
            modelAnswer: `Beta-minus decay increases proton number by 1: ${Z} → ${finalZ}.`
          };
        }
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const initialN = Math.floor(Math.random() * 50 + 50);
          return { 
            text: `In β– decay, if a nucleus has nucleon number ${initialN}, what remains?`,
            answer: initialN.toString(),
            modelAnswer: `The nucleon number remains ${initialN}.`
          };
        }
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const initialZ = Math.floor(Math.random() * 20 + 10);
          const finalZ = initialZ - 1;
          return { 
            text: `A nucleus with proton number ${initialZ} undergoes β+ decay. What is its new proton number?`,
            answer: finalZ.toString(),
            modelAnswer: `Proton number decreases by 1: ${initialZ} → ${finalZ}.`
          };
        }
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const initialMass = Math.floor(Math.random() * 200 + 100);
          const finalMass = initialMass - 4;
          return { 
            text: `A nucleus with mass number ${initialMass} undergoes alpha decay. What is its new mass number?`,
            answer: finalMass.toString(),
            modelAnswer: `Mass number decreases by 4: ${initialMass} → ${finalMass}.`
          };
        }
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "equation",
        question: function() {
          const initialMass = Math.floor(Math.random() * 200 + 100);
          const change = 4;
          return { 
            text: `A nucleus with mass number ${initialMass} undergoes alpha decay. By how much does its mass number change?`,
            answer: change.toString(),
            modelAnswer: `It decreases by 4.`
          };
        }
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "definition",
        question: "Define nucleon number.",
        modelAnswer: "Nucleon number is the total count of protons and neutrons in a nucleus.",
        keywords: [["protons"], ["neutrons"], ["total"]]
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "definition",
        question: "Define proton number.",
        modelAnswer: "Proton number is the count of protons in a nucleus.",
        keywords: [["proton"], ["number"]]
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "definition",
        question: "Define isotope.",
        modelAnswer: "Isotopes are atoms of the same element with the same number of protons but different numbers of neutrons.",
        keywords: [["same protons"], ["different neutrons"]]
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "definition",
        question: "Define a hadron.",
        modelAnswer: "A hadron is a composite particle made of quarks that participates in the strong force.",
        keywords: [["quarks"], ["strong force"]]
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "definition",
        question: "Define a baryon.",
        modelAnswer: "A baryon is a hadron composed of three quarks.",
        keywords: [["three quarks"]]
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "definition",
        question: "Define a meson.",
        modelAnswer: "A meson is a hadron composed of a quark and an antiquark.",
        keywords: [["quark"], ["antiquark"]]
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "definition",
        question: "Define a lepton.",
        modelAnswer: "A lepton is a fundamental particle that does not experience the strong nuclear force.",
        keywords: [["fundamental"], ["lepton"]]
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "definition",
        question: "Define a quark.",
        modelAnswer: "A quark is a fundamental particle that comes in six flavors: up, down, charm, strange, top, and bottom.",
        keywords: [["up"], ["down"], ["charm"], ["strange"], ["top"], ["bottom"]]
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "definition",
        question: "State the charges of up and down quarks.",
        modelAnswer: "Up quark: +2/3 e; Down quark: -1/3 e.",
        keywords: [["+2/3"], ["-1/3"]]
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "definition",
        question: "State the quark composition of a proton.",
        modelAnswer: "A proton consists of two up quarks and one down quark (uud).",
        keywords: [["uud"]]
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "definition",
        question: "State the quark composition of a neutron.",
        modelAnswer: "A neutron consists of one up quark and two down quarks (udd).",
        keywords: [["udd"]]
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "definition",
        question: "Define an antiparticle.",
        modelAnswer: "An antiparticle has the same mass but opposite charge compared to its corresponding particle.",
        keywords: [["opposite charge"]]
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "definition",
        question: "What is emitted during β– decay?",
        modelAnswer: "An electron and an electron antineutrino are emitted.",
        keywords: [["electron"], ["antineutrino"]]
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "definition",
        question: "What is emitted during β+ decay?",
        modelAnswer: "A positron and an electron neutrino are emitted.",
        keywords: [["positron"], ["electron neutrino"]]
      },
      {
        topic: 11,
        difficulty: "easy",
        type: "definition",
        question: "Define the unified atomic mass unit (u).",
        modelAnswer: "1 u is 1/12 the mass of a carbon-12 atom.",
        keywords: [["1/12"], ["carbon-12"]]
      },
      {
        topic: 11,
        difficulty: "hard",
        type: "numeric_multi",
        question: function() {
          return { 
            text: "A nucleus with mass number 210 and atomic number 84 undergoes β– decay followed by alpha decay. Calculate the final mass number and atomic number.",
            answer: ["206", "83"],
            modelAnswer: [
              "After β– decay, nucleon number remains 210; then alpha decay reduces mass number by 4 and atomic number by about 1 resulting in 206 and 83."
            ]
          };
        }
      }
    ];

    /* -----------------------------
       Combine All Topics into Question Bank
    ----------------------------- */
    const questionBank = [].concat(
      additionalQuestionsTopic1,
      additionalQuestionsTopic2,
      additionalQuestionsTopic3,
      additionalQuestionsTopic4,
      additionalQuestionsTopic5,
      additionalQuestionsTopic6,
      additionalQuestionsTopic7,
      additionalQuestionsTopic8,
      additionalQuestionsTopic9,
      additionalQuestionsTopic10,
      additionalQuestionsTopic11
    );
    
    /* -----------------------------
       Topic Checkboxes Functions
    ----------------------------- */
    const topicsArrNames = [
      "Physical quantities and units",
      "Kinematics",
      "Dynamics",
      "Forces, density and pressure",
      "Work, energy and power",
      "Deformation of solids",
      "Waves",
      "Superposition",
      "Electricity",
      "D.C. circuits",
      "Particle and nuclear physics"
    ];
    
    function generateTopicCheckboxes() {
      const left = document.getElementById("topic-columns-left");
      const right = document.getElementById("topic-columns-right");
      topicsArrNames.forEach((name, i) => {
        const topicNum = i + 1;
        const block = `<h3>${topicNum}. ${name}</h3>
          <label><input type="checkbox" id="topic${topicNum}-defs"> Definitions</label>
          <label><input type="checkbox" id="topic${topicNum}-eqs"> Equations</label>`;
        if (i % 2 === 0) {
          left.innerHTML += block;
        } else {
          right.innerHTML += block;
        }
      });
    }
    
    function toggleByGroup(typeSuffix, isChecked) {
      const boxes = document.querySelectorAll(`input[id$="-${typeSuffix}"]`);
      boxes.forEach(box => box.checked = isChecked);
    }
    
    function getSelectedDifficulty() {
      const radios = document.getElementsByName("difficulty");
      for (let radio of radios) {
        if (radio.checked) return radio.value;
      }
      return "easy";
    }
    
    function getCheckedTopicModes() {
      const wholeDefs = document.getElementById("whole-defs").checked;
      const wholeEqs = document.getElementById("whole-eqs").checked;
      const modes = [];
      for (let i = 1; i <= topicsArrNames.length; i++) {
        const defBox = document.getElementById(`topic${i}-defs`);
        const eqBox = document.getElementById(`topic${i}-eqs`);
        modes.push({ topic: i, defs: defBox ? defBox.checked : false, eqs: eqBox ? eqBox.checked : false });
      }
      return { topics: modes, wholeDefs, wholeEqs };
    }
    
    // Build question pool without evaluating the dynamic question functions
    function buildQuestionPool() {
      const { topics: topicModes, wholeDefs, wholeEqs } = getCheckedTopicModes();
      const diff = getSelectedDifficulty();
      let filtered = [];
      questionBank.forEach(q => {
        let matched = false;
        const isDef = (q.type === "definition");
        const isEq = (q.type === "equation" || q.type === "numeric" || q.type === "numeric_multi" || q.type === "numeric_dynamic");
        if (wholeDefs && isDef) matched = true;
        if (wholeEqs && isEq) matched = true;
        const topicSetting = topicModes.find(item => item.topic === q.topic);
        if (!matched && topicSetting) {
          if (isDef && topicSetting.defs) matched = true;
          if (isEq && topicSetting.eqs) matched = true;
        }
        if (matched) filtered.push(q);
      });
      if (diff === "easy") {
        filtered = filtered.filter(q => q.difficulty === "easy" || !q.difficulty);
      } else if (diff === "hard") {
        filtered = filtered.filter(q => q.difficulty === "hard");
      }
      return filtered;
    }
    
    /* -----------------------------
       Practice Flow Functions
    ----------------------------- */
    function startPractice() {
      score = 0;
      document.getElementById("score").innerText = score;
      answeredCurrent = false;
      mixedCount = 0;
      const pool = buildQuestionPool();
      if (pool.length === 0) {
        document.getElementById("question-box").innerText = "No matching questions available yet.";
        return;
      }
      questionPool = pool;
      askNewQuestion();
      document.getElementById("question-box").scrollIntoView({ behavior: 'smooth' });
    }
    
    function askNewQuestion() {
      answeredCurrent = false;
      document.getElementById("feedback").innerText = "";
      if (!questionPool || questionPool.length === 0) {
        document.getElementById("question-box").innerText = "No matching questions available yet.";
        return;
      }
      const diff = getSelectedDifficulty();
      let subset = questionPool;
      if (diff === "mixed") {
        subset = (mixedCount % 3 < 2)
          ? questionPool.filter(q => q.difficulty === "easy" || !q.difficulty)
          : questionPool.filter(q => q.difficulty === "hard");
        mixedCount++;
      }
      if (subset.length === 0) subset = questionPool;
      const chosen = getRandom(subset);
      loadQuestion(chosen);
    }
    
    // When loading a question, if it is dynamic (question is a function), re-evaluate it now
    function loadQuestion(q) {
      currentQuestion = q;
      if (typeof q.question === "function") {
        const built = q.question();
        q.text = built.text;
        q.answer = built.answer;
        q.modelAnswer = built.modelAnswer;
        q.image = built.image || null;
      } else{
      q.text = q.question;
      }      
      document.getElementById("diagramContainer").innerHTML = "";
      document.getElementById("answerInputs").innerHTML = "";
      document.getElementById("feedback").innerText = "";
      document.getElementById("question-box").innerText = "Question: " + q.text;
      if (q.image) {
        document.getElementById("diagramContainer").innerHTML = q.image;
      }
      if (q.type === "definition") {
        const inp = document.createElement("input");
        inp.type = "text";
        inp.id = "answerInput";
        inp.placeholder = "Enter your answer...";
        document.getElementById("answerInputs").appendChild(inp);
        currentAnswers = q.answer ? [q.answer] : q.keywords;
      } else if (q.type === "equation" || q.type === "numeric" || q.type === "numeric_dynamic") {
        const inp = document.createElement("input");
        inp.type = "text";
        inp.id = "answerInput";
        inp.placeholder = "Enter your answer...";
        document.getElementById("answerInputs").appendChild(inp);
        currentAnswers = [q.answer];
      } else if (q.type === "numeric_multi") {
        const inp1 = document.createElement("input");
        inp1.type = "text";
        inp1.id = "answerInput1";
        inp1.placeholder = "Part (a)";
        inp1.style.width = "100px";
        const inp2 = document.createElement("input");
        inp2.type = "text";
        inp2.id = "answerInput2";
        inp2.placeholder = "Part (b)";
        inp2.style.width = "100px";
        inp2.style.marginLeft = "10px";
        document.getElementById("answerInputs").appendChild(inp1);
        document.getElementById("answerInputs").appendChild(inp2);
        if (Array.isArray(q.answer) && q.answer.length === 3) {
          const inp3 = document.createElement("input");
          inp3.type = "text";
          inp3.id = "answerInput3";
          inp3.placeholder = "Part (c)";
          inp3.style.width = "100px";
          inp3.style.marginLeft = "10px";
          document.getElementById("answerInputs").appendChild(inp3);
        }
        currentAnswers = q.answer;
      }
    }
    
    function checkAnswer() {
      if (!currentQuestion || answeredCurrent) return;
      let userAns;
      if (currentQuestion.type === "numeric_multi") {
        const inputs = document.querySelectorAll("#answerInputs input");
        userAns = Array.from(inputs).map(inp => inp.value.trim());
      } else {
        userAns = document.getElementById("answerInput").value.trim();
      }
      let correct = false;
      if (currentQuestion.type === "definition") {
        const ansLower = userAns.toLowerCase();
        correct = true;
        for (let group of currentAnswers) {
          let found = group.some(word => ansLower.includes(word));
          if (!found) { correct = false; break; }
        }
      } else if (currentQuestion.type === "equation" || currentQuestion.type === "numeric" || currentQuestion.type === "numeric_dynamic") {
        const userNum = parseFloat(userAns);
        const correctNum = parseFloat(currentAnswers[0]);
        if (!isNaN(userNum) && Math.abs(userNum - correctNum) < Math.max(0.01 * Math.abs(correctNum), 0.1))
          correct = true;
      } else if (currentQuestion.type === "numeric_multi") {
        correct = true;
        for (let i = 0; i < currentAnswers.length; i++) {
          const userNum = parseFloat(userAns[i]);
          const correctNum = parseFloat(currentAnswers[i]);
          if (isNaN(userNum) || Math.abs(userNum - correctNum) > Math.max(0.01 * Math.abs(correctNum), 0.1)) {
            correct = false;
            break;
          }
        }
      }
      const fb = document.getElementById("feedback");
      if (correct) {
        fb.innerText = "✔ Correct!";
        score++;
        document.getElementById("score").innerText = score;
      } else {
        fb.innerText = "✘ Not quite correct.";
      }
      answeredCurrent = true;
    }
    
    function showModelAnswer() {
      if (!currentQuestion) return;
      let modelText = "Model Answer: ";
      if (currentQuestion.type === "numeric_multi") {
        if (Array.isArray(currentQuestion.modelAnswer))
          modelText += currentQuestion.modelAnswer.join(" | ");
        else modelText += currentQuestion.modelAnswer;
      } else {
        modelText += currentQuestion.modelAnswer;
      }
      document.getElementById("feedback").innerText = modelText;
      answeredCurrent = true;
    }
    
    // Create buttons for Check, Show, and Next Question
    const checkBtn = document.createElement("button");
    checkBtn.innerText = "Check Answer";
    checkBtn.style.marginRight = "10px";
    checkBtn.onclick = checkAnswer;
    document.getElementById("question-box").parentNode.insertBefore(checkBtn, document.getElementById("question-box").nextSibling);
    
    const showBtn = document.createElement("button");
    showBtn.innerText = "Show Model Answer";
    showBtn.style.marginRight = "10px";
    showBtn.onclick = showModelAnswer;
    checkBtn.parentNode.insertBefore(showBtn, checkBtn.nextSibling);
    
    const nextBtn = document.createElement("button");
    nextBtn.innerText = "Next Question";
    nextBtn.onclick = askNewQuestion;
    showBtn.parentNode.insertBefore(nextBtn, showBtn.nextSibling);
    
    // On page load, generate topic checkboxes.
    generateTopicCheckboxes();
  </script>
</body>
</html>
